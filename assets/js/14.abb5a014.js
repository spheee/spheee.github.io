(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{217:function(a,s,t){"use strict";t.r(s);var e=t(0),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"javascript-的单线程设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javascript-的单线程设计","aria-hidden":"true"}},[a._v("#")]),a._v(" JavaScript 的单线程设计")]),a._v(" "),t("h2",{attrs:{id:"为什么要设计成单线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要设计成单线程","aria-hidden":"true"}},[a._v("#")]),a._v(" 为什么要设计成单线程")]),a._v(" "),t("p",[a._v("JavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？")]),a._v(" "),t("p",[a._v("所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。")]),a._v(" "),t("p",[a._v("为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。")]),a._v(" "),t("h2",{attrs:{id:"javascript-是单线程的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javascript-是单线程的","aria-hidden":"true"}},[a._v("#")]),a._v(" JavaScript 是单线程的")]),a._v(" "),t("blockquote",[t("p",[a._v("因为JS运行在浏览器中，是单线程的，每个window一个JS线程，既然是单线程的，在某个特定的时刻只有特定的代码能够被执行，并阻塞其它的代码。"),t("br"),a._v("\n而浏览器是事件驱动的（Event driven），浏览器中很多行为是异步（Asynchronized）的，会创建事件并放入执行队列中。javascript引擎是单线程处理它的任务队列，你可以理解成就是普通函数和回调函数构成的队列。当异步事件发生时，如mouse click, a timer firing, or an XMLHttpRequest completing（鼠标点击事件发生、定时器触发事件发生、XMLHttpRequest完成回调触发等），将他们放入执行队列，等待当前代码执行完成。")])]),a._v(" "),t("h3",{attrs:{id:"异步事件驱动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步事件驱动","aria-hidden":"true"}},[a._v("#")]),a._v(" 异步事件驱动")]),a._v(" "),t("p",[a._v("前面已经提到浏览器是事件驱动的（Event driven），浏览器中很多行为是异步（Asynchronized）的，例如：鼠标点击事件、窗口大小拖拉事件、定时器触发事件、XMLHttpRequest完成回调等。当一个异步事件发生的时候，它就进入事件队列。浏览器有一个内部大消息循环，Event Loop（事件循环），会轮询大的事件队列并处理事件。例如，浏览器当前正在忙于处理onclick事件，这时另外一个事件发生了（如：window onSize），这个异步事件就被放入事件队列等待处理，只有前面的处理完毕了，空闲了才会执行这个事件。setTimeout也是一样，当调用的时候，js引擎会启动定时器timer，大约xxms以后执行xxx，当定时器时间到，就把该事件放到主事件队列等待处理（浏览器不忙的时候才会真正执行")]),a._v(" "),t("h2",{attrs:{id:"浏览器不是单线程的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浏览器不是单线程的","aria-hidden":"true"}},[a._v("#")]),a._v(" 浏览器不是单线程的")]),a._v(" "),t("p",[a._v("浏览器不是单线程的\n虽然JS运行在浏览器中，是单线程的，每个window一个JS线程，但浏览器不是单线程的，例如Webkit或是Gecko引擎，都可能有如下线程：")]),a._v(" "),t("ul",[t("li",[a._v("javascript引擎线程")]),a._v(" "),t("li",[a._v("界面渲染线程")]),a._v(" "),t("li",[a._v("浏览器事件触发线程")]),a._v(" "),t("li",[a._v("Http请求线程"),t("br"),a._v("\n如果js是单线程的，那么谁去轮询大的Event loop事件队列？答案是浏览器会有单独的线程去处理这个队列。")])]),a._v(" "),t("h2",{attrs:{id:"ajax-异步请求是否是真的异步？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ajax-异步请求是否是真的异步？","aria-hidden":"true"}},[a._v("#")]),a._v(" Ajax 异步请求是否是真的异步？")]),a._v(" "),t("p",[a._v("既然说JavaScript是单线程运行的，那么XMLHttpRequest在连接后是否真的异步?"),t("br"),a._v("\n其实请求确实是异步的，这请求是由浏览器新开一个线程请求（见前面的浏览器多线程）。当请求的状态变更时，如果先前已设置回调，这异步线程就产生状态变更事件放到 JavaScript引擎的事件处理队列中等待处理。当浏览器空闲的时候出队列任务被处理，JavaScript引擎始终是单线程运行回调函数。javascript引擎确实是单线程处理它的任务队列，能理解成就是普通函数和回调函数构成的队列。")]),a._v(" "),t("p",[a._v("总结一下，Ajax请求确实是异步的，这请求是由浏览器新开一个线程请求，事件回调的时候是放入Event loop单线程事件队列等候处理。")]),a._v(" "),t("h2",{attrs:{id:"非阻塞js的实现（non-blocking-javascript）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非阻塞js的实现（non-blocking-javascript）","aria-hidden":"true"}},[a._v("#")]),a._v(" 非阻塞js的实现（non-blocking javascript）")]),a._v(" "),t("h3",{attrs:{id:"defer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#defer","aria-hidden":"true"}},[a._v("#")]),a._v(" defer")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('<script type="text/javascript" defer src="foo.js"><\/script>\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"async"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#async","aria-hidden":"true"}},[a._v("#")]),a._v(" async")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('<script type="text/javascript" async src="foo.js"><\/script>\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("更多内容参考 async与defer")]),a._v(" "),t("h3",{attrs:{id:"动态加载js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动态加载js","aria-hidden":"true"}},[a._v("#")]),a._v(" 动态加载JS")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('setTimeout(function(){\n    var script = document.createElement("script");\n    script.type = "text/javascript";\n    script.src = "foo.js";\n    var head = true; //加在头还是尾\n    if(head)\n      document.getElementsByTagName("head")[0].appendChild(script);\n    else\n      document.body.appendChild(script); \n}, 0);\n \n//另外一个独立的动态加载js的函数\nfunction loadJs(jsurl, head, callback){\n    var script=document.createElement(\'script\');\n    script.setAttribute("type","text/javascript");\n     \n    if(callback){\n        if (script.readyState){  //IE\n            script.onreadystatechange = function(){\n                if (script.readyState == "loaded" ||\n                        script.readyState == "complete"){\n                    script.onreadystatechange = null;\n                    callback();\n                }\n            };\n        } else {  //Others\n            script.onload = function(){\n                callback();\n            };\n        }\n    }\n    script.setAttribute("src", jsurl);\n     \n    if(head)\n     document.getElementsByTagName(\'head\')[0].appendChild(script); \n    else\n      document.body.appendChild(script); \n \n}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);